"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),(()=>{var e;const t=exports.MonTY;let l=exports.callOutLists;delete exports.callOutLists;const s=exports.callOutResponseTypes;delete exports.callOutResponseTypes;const n=exports.callOutsCanUpdate,a=exports.callOutsCanManage,o=document.querySelector("#callOuts--searchFilter"),i=document.querySelector("#callOuts--searchResults");let r="",c=[];function u(){var e,t;const s=document.createElement("div");s.className="panel";const n=o.value.trim().toLowerCase().split(" ");for(const a of l){let l=!0;const o=(a.listName+" "+(null!==(e=a.listDescription)&&void 0!==e?e:"")).toLowerCase();for(const e of n)if(!o.includes(e)){l=!1;break}if(!l)continue;const i=document.createElement("a");i.className="panel-block",i.dataset.listId=a.listId.toString(),i.href="#",i.innerHTML=`<span class="panel-icon">\n        <i class="fas fa-list-ol" aria-hidden="true"></i>\n        </span>\n        <div>\n          <strong>${a.listName}</strong><br />\n          <span class="is-size-7">${null!==(t=a.listDescription)&&void 0!==t?t:""}</span>\n        </div>`,i.addEventListener("click",p),s.append(i)}s.hasChildNodes()?(i.innerHTML="",i.append(s)):i.innerHTML='<div class="message is-info">\n        <p class="message-body">There are no call out lists that meet your search criteria.</p>\n        </div>'}function d(e){e.preventDefault(),function e(a){const o=l.find(e=>e.listId===r);let i=0;const u=c.find((e,t)=>e.employeeNumber===a&&(i=t,!0));let d,m;function p(e){e.preventDefault();const l=e.currentTarget;cityssm.postJSON(t.urlPrefix+"/attendance/doAddCallOutRecord",l,e=>{const t=e;t.success&&(bulmaJS.alert({message:"Call out recorded successfully.",contextualColorName:"success"}),l.reset(),m=t.callOutRecords,y())})}function y(){var e,t;d.querySelector("#tag--recentCalls").textContent=m.length.toString();const l=d.querySelector("#container--callOutRecords"),s=d.querySelector("#callOutListMember--callOutDateTimeMax");if(0===m.length)return l.innerHTML='<div class="message is-info">\n          <p class="message-body">There are no recent call outs to show.</p>\n          </div>',void(s.textContent="(No Recent Call Outs)");const n=document.createElement("div");n.className="panel";for(const[l,a]of m.entries()){const o=new Date(a.callOutDateTime);0===l&&(s.innerHTML=`${a.isSuccessful?'<i class="fas fa-fw fa-check has-text-success" aria-label="Yes"></i>':'<i class="fas fa-fw fa-times has-text-danger" aria-label="No"></i>'}\n            ${o.toLocaleDateString()} ${o.toLocaleTimeString()}`);const i=document.createElement("div");i.className="panel-block",i.classList.add(a.isSuccessful?"has-background-success-light":"has-background-danger-light"),i.innerHTML=`<div class="columns">\n          <div class="column is-narrow">\n            ${a.isSuccessful?'<i class="fas fa-fw fa-check has-text-success" aria-label="Yes"></i>':'<i class="fas fa-fw fa-times has-text-danger" aria-label="No"></i>'}\n          </div>\n          <div class="column">\n            ${o.toLocaleDateString()} ${o.toLocaleTimeString()}<br />\n            <span class="is-size-7">\n              <strong>${null!==(e=a.responseType)&&void 0!==e?e:"(No Response)"}</strong><br />\n              ${null!==(t=a.recordComment)&&void 0!==t?t:""}\n            </span>\n          </div>\n          </div>`,n.append(i)}l.innerHTML="",l.append(n)}cityssm.openHtmlModal("callOuts-member",{onshow(e){var l,s,r,p,v,b,f,g,L,S,N;d=e;const O=u.employeeSurname+", "+u.employeeGivenName;e.querySelector(".modal-card-title").textContent=O,e.querySelector("#callOutListMember--listName").textContent=o.listName,e.querySelector("#callOutListMember--employeeName").textContent=O,e.querySelector("#callOutListMember--employeeNumber").textContent=u.employeeNumber,e.querySelector("#callOutListMember--sortKey").textContent=null!==(l=u.sortKey)&&void 0!==l?l:"",e.querySelector("#callOutListMember--listPosition").textContent=`${i+1} / ${c.length}`,n?(e.querySelector("#callOutListMember--workContact1").textContent=null!==(s=u.workContact1)&&void 0!==s?s:"",e.querySelector("#callOutListMember--workContact2").textContent=null!==(r=u.workContact2)&&void 0!==r?r:"",e.querySelector("#callOutListMember--homeContact1").textContent=null!==(p=u.homeContact1)&&void 0!==p?p:"",e.querySelector("#callOutListMember--homeContact2").textContent=null!==(v=u.homeContact2)&&void 0!==v?v:""):(null===(f=null===(b=e.querySelector('a[href$="tab--callNow"]'))||void 0===b?void 0:b.closest("li"))||void 0===f||f.remove(),null===(g=e.querySelector("#tab--callNow"))||void 0===g||g.remove(),null===(S=null===(L=e.querySelector('a[href$="tab--recentCalls"]'))||void 0===L?void 0:L.closest("li"))||void 0===S||S.classList.add("is-active"),null===(N=e.querySelector("#tab--recentCalls"))||void 0===N||N.classList.remove("is-hidden")),cityssm.postJSON(t.urlPrefix+"/attendance/doGetCallOutRecords",{listId:o.listId,employeeNumber:a},e=>{m=e.callOutRecords,y()})},onshown(t,l){if(bulmaJS.toggleHtmlClipped(),bulmaJS.init(t),n){t.querySelector("#callOutRecordAdd--listId").value=o.listId,t.querySelector("#callOutRecordAdd--employeeNumber").value=u.employeeNumber;const e=t.querySelector("#callOutRecordAdd--responseTypeId");for(const t of s){const l=document.createElement("option");l.value=t.responseTypeId.toString(),l.textContent=t.responseType,e.append(l)}t.querySelector("#form--callOutRecordAdd").addEventListener("submit",p)}const a=t.querySelector("#callOutListMember--next");i+1===c.length?a.disabled=!0:a.addEventListener("click",()=>{const t=c[i+1].employeeNumber;l(),e(t)});const r=t.querySelector("#callOutListMember--previous");0===i?r.disabled=!0:r.addEventListener("click",()=>{const t=c[i-1].employeeNumber;l(),e(t)})},onhidden(){bulmaJS.toggleHtmlClipped()}})}(e.currentTarget.dataset.employeeNumber)}function m(e){r=e,c=[];const s=l.find(t=>t.listId===e);let n;function o(e){if(e.preventDefault(),!a)return void bulmaJS.alert({title:"Access Denied",message:"You do not have permission to update call out lists.",contextualColorName:"danger"});const s=e.currentTarget.querySelector('button[type="submit"]');s.disabled=!0,s.classList.add("is-loading"),cityssm.postJSON(t.urlPrefix+"/attendance/doUpdateCallOutList",e.currentTarget,e=>{const t=e;s.disabled=!1,s.classList.remove("is-loading"),t.success?(bulmaJS.alert({message:"Call out list updated successfully.",contextualColorName:"success"}),n.querySelector(".modal-card-title").textContent=n.querySelector("#callOutListEdit--listName").value,c=t.callOutListMembers,m=t.availableEmployees,b(),v(),l=t.callOutLists,u()):bulmaJS.alert({title:"Error Updating Call Out List",message:"Please try again.",contextualColorName:"danger"})})}let i=[],m=[];function p(e){e.preventDefault();const l=e.currentTarget.dataset.employeeNumber;cityssm.postJSON(t.urlPrefix+"/attendance/doAddCallOutListMember",{listId:s.listId,employeeNumber:l},e=>{const t=e;t.success?(c=t.callOutListMembers,b(),v()):bulmaJS.alert({title:"Error Adding Member",message:"Please try again.",contextualColorName:"danger"})})}function y(e){e.preventDefault();const l=e.currentTarget.dataset.employeeNumber;bulmaJS.confirm({title:"Remove Employee from Call Out List",message:`Are you sure you want to remove employee ${l} from the list?`,contextualColorName:"warning",okButton:{text:"Yes, Remove Them",callbackFunction:function(){cityssm.postJSON(t.urlPrefix+"/attendance/doDeleteCallOutListMember",{listId:s.listId,employeeNumber:l},e=>{const t=e;t.success?(c=t.callOutListMembers,b(),v()):bulmaJS.alert({title:"Error Removing Member",message:"Please try again.",contextualColorName:"danger"})})}}})}function v(){var e;if(!a)return;const t=n.querySelector("#container--callOutListAvailableEmployees"),l=document.createElement("div");l.className="panel";for(const t of m){if(i.includes(t.employeeNumber))continue;const s=document.createElement("a");s.className="panel-block",s.href="#",s.dataset.employeeNumber=t.employeeNumber,s.innerHTML=`<span class="panel-icon">\n          <i class="fas fa-plus" aria-hidden="true"></i>\n          </span>\n          <div>\n            <strong>${t.employeeSurname}, ${t.employeeGivenName}</strong><br />\n            <span class="is-size-7">${null!==(e=t.jobTitle)&&void 0!==e?e:""}</span>\n          </div>`,s.addEventListener("click",p),l.append(s)}l.hasChildNodes()?(t.innerHTML="",t.append(l)):t.innerHTML='<div class="message is-info is-small">\n            <p class="message-body">There are no employees available to add.</p>\n          </div>'}function b(){var e;const t=n.querySelector("#container--callOutListMembers"),l=n.querySelector("#container--callOutListCurrentMembers");if(i=[],0===c.length)return t.innerHTML=`<div class="message is-warning">\n            <p class="message-body">The "${s.listName}" call out list does not include any active employees.</p>\n          </div>`,void(l.innerHTML='<div class="message is-warning is-small">\n            <p class="message-body">No active employees.</p>\n          </div>');const o=document.createElement("div");let r;o.className="panel",a&&((r=document.createElement("div")).className="panel");for(const t of c){const l=document.createElement("a");if(l.className="panel-block is-block",l.href="#",l.dataset.employeeNumber=t.employeeNumber,l.innerHTML=`<div class="columns is-mobile">\n          <div class="column is-narrow">\n            <i class="fas fa-user" aria-hidden="true"></i>\n          </div>\n          <div class="column">\n            <strong>${t.employeeSurname}, ${t.employeeGivenName}</strong><br />\n            <span class="is-size-7">${t.employeeNumber}</span>\n          </div>\n          <div class="column">\n            <span class="is-size-7 has-tooltip-left" data-tooltip="Sort Key">\n              <i class="fas fa-sort-alpha-down" aria-hidden="true"></i> ${null!==(e=t.sortKey)&&void 0!==e?e:""}\n            </span>\n          </div>\n          </div>`,l.addEventListener("click",d),o.append(l),!a)continue;i.push(t.employeeNumber);const s=document.createElement("a");s.className="panel-block",s.href="#",s.dataset.employeeNumber=t.employeeNumber,s.innerHTML=`<span class="panel-icon">\n          <i class="fas fa-minus" aria-hidden="true"></i>\n          </span>\n          <div>\n            <strong>${t.employeeSurname}, ${t.employeeGivenName}</strong>\n          </div>`,s.addEventListener("click",y),r.append(s)}t.innerHTML="",t.append(o),a&&(l.innerHTML="",l.append(r))}cityssm.openHtmlModal("callOuts-list",{onshow(e){var l,i;n=e,e.querySelector(".modal-card-title").textContent=s.listName,a&&(null===(i=null===(l=e.querySelector(".menu a[href$='tab--callOuts-memberManagement']"))||void 0===l?void 0:l.closest("li"))||void 0===i||i.classList.remove("is-hidden")),function(){var e,t,l,i,r;n.querySelector("#callOutListEdit--listId").value=s.listId,n.querySelector("#callOutListEdit--listName").value=s.listName,n.querySelector("#callOutListEdit--listDescription").value=null!==(e=s.listDescription)&&void 0!==e?e:"";let c=!1;const u=n.querySelector("#callOutListEdit--eligibilityFunction");for(const e of exports.employeeEligibilityFunctionNames){const t=document.createElement("option");t.value=e,t.textContent=e,e===s.eligibilityFunction&&(t.selected=!0,c=!0),u.append(t)}if(!c&&""!==(null!==(t=s.eligibilityFunction)&&void 0!==t?t:"")){const e=document.createElement("option");e.value=s.eligibilityFunction,e.textContent=s.eligibilityFunction,e.selected=!0,u.append(e)}let d=!1;const m=n.querySelector("#callOutListEdit--sortKeyFunction");for(const e of exports.employeeSortKeyFunctionNames){const t=document.createElement("option");t.value=e,t.textContent=e,e===s.sortKeyFunction&&(t.selected=!0,d=!0),m.append(t)}if(!d&&""!==(null!==(l=s.sortKeyFunction)&&void 0!==l?l:"")){const e=document.createElement("option");e.value=s.sortKeyFunction,e.textContent=s.sortKeyFunction,e.selected=!0,m.append(e)}if(n.querySelector("#callOutListEdit--employeePropertyName").value=null!==(i=s.employeePropertyName)&&void 0!==i?i:"",a){const e=n.querySelector("#callOutListEdit--unlockButtons");e.classList.remove("is-hidden"),null===(r=e.querySelector("button"))||void 0===r||r.addEventListener("click",()=>{var t;e.remove(),null===(t=n.querySelector("#callOutListEdit--updateButtons"))||void 0===t||t.classList.remove("is-hidden");const l=n.querySelector("#form--callOutListEdit");l.addEventListener("submit",o),l.querySelector("fieldset").disabled=!1})}}(),cityssm.postJSON(t.urlPrefix+"/attendance/doGetCallOutListMembers",{listId:s.listId,includeAvailableEmployees:a},e=>{const t=e;c=t.callOutListMembers,m=t.availableEmployees,b(),v()})},onshown(e,l){bulmaJS.toggleHtmlClipped(),t.initializeMenuTabs(e.querySelectorAll(".menu a"),e.querySelectorAll(".tabs-container > article")),cityssm.enableNavBlocker()},onhidden(){bulmaJS.toggleHtmlClipped(),cityssm.disableNavBlocker(),r="",c=[]}})}function p(e){e.preventDefault(),m(e.currentTarget.dataset.listId)}null===(e=document.querySelector("#callOuts--create"))||void 0===e||e.addEventListener("click",()=>{let e;function s(s){s.preventDefault(),cityssm.postJSON(t.urlPrefix+"/attendance/doCreateCallOutList",s.currentTarget,t=>{l=t.callOutLists,u(),e()})}cityssm.openHtmlModal("callOuts-createList",{onshown(t,l){var n;e=l,null===(n=t.querySelector("#form--callOutListAdd"))||void 0===n||n.addEventListener("submit",s)}})}),u(),o.addEventListener("keyup",u)})();