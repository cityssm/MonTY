"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),(()=>{const e=exports.MonTY,n=exports.absenceTypes,s=exports.employees,o=exports.absencesCanUpdate,t=exports.returnsToWorkCanUpdate;let a=exports.absenceRecords,l=exports.returnToWorkRecords;function r(){var e,n,s;const o=document.querySelector("#container--absences");if(null===o)return;if(0===a.length)return void(o.innerHTML='<div class="message is-info">\n        <p class="message-body">There are no recent absence records to show.</p>\n        </div>');const t=document.createElement("div");t.className="panel";for(const o of a){const a=new Date(o.absenceDateTime),l=document.createElement("div");l.className="panel-block is-block",Date.now()-a.getTime()<=864e5&&l.classList.add("has-background-success-light"),l.innerHTML=`<div class="columns">\n        <div class="column is-narrow">\n          <i class="fas fa-sign-out-alt" aria-hidden="true"></i>\n        </div>\n        <div class="column">\n          <strong data-tooltip="Absence Date">\n            ${a.toLocaleDateString()}\n          </strong>\n        </div>\n        <div class="column">\n          <strong>${o.employeeName}</strong><br />\n          <span class="is-size-7">${null!==(e=o.employeeNumber)&&void 0!==e?e:""}</span>\n        </div>\n        <div class="column">\n          <strong data-tooltip="Absence Type">${null!==(n=o.absenceType)&&void 0!==n?n:o.absenceTypeKey}</strong><br />\n          <span class="is-size-7">${null!==(s=o.recordComment)&&void 0!==s?s:""}</span>\n        </div>\n        </div>`,t.append(l)}o.innerHTML="",o.append(t)}function c(){var e,n,s;const o=document.querySelector("#container--returnsToWork");if(null===o)return;if(0===a.length)return void(o.innerHTML='<div class="message is-info">\n        <p class="message-body">There are no recent return to work records to show.</p>\n        </div>');const t=document.createElement("div");t.className="panel";for(const o of l){const a=new Date(o.returnDateTime),l=document.createElement("div");l.className="panel-block is-block",Date.now()-a.getTime()<=864e5&&l.classList.add("has-background-success-light"),l.innerHTML=`<div class="columns">\n        <div class="column is-narrow">\n          <i class="fas fa-sign-in-alt" aria-hidden="true"></i>\n        </div>\n        <div class="column">\n          <strong data-tooltip="Return Date">${a.toLocaleDateString()}</strong>\n        </div>\n        <div class="column">\n          <strong>${o.employeeName}</strong><br />\n          <span class="is-size-7">${null!==(e=o.employeeNumber)&&void 0!==e?e:""}</span>\n        </div>\n        <div class="column">\n          <strong data-tooltip="Return Shift">${null!==(n=o.returnShift)&&void 0!==n?n:"(No Shift)"}</strong><br />\n          <span class="is-size-7">${null!==(s=o.recordComment)&&void 0!==s?s:""}</span>\n        </div>\n        </div>`,t.append(l)}o.innerHTML="",o.append(t)}function i(i){let d,u,m="";function p(){const e=d.querySelector("#callInAdd--employeeNumber"),n=e.value.toLowerCase();if(n===m)return;m=n;const o=d.querySelector("#callInAdd--employeeName");o.value="";const t=s.filter(e=>n.length>=e.employeeNumber.length/2&&e.employeeNumber.toLowerCase().endsWith(n));1===t.length&&(e.value=t[0].employeeNumber,m=t[0].employeeNumber.toLowerCase(),o.value=(t[0].employeeGivenName+" "+t[0].employeeSurname).trim())}function v(){const e=d.querySelectorAll('input[name="callInType"]');for(const n of e){const e=n.closest("label"),s=d.querySelector(`fieldset[data-call-in-type="${n.value}"]`);n.checked?(e.classList.add("is-link"),e.querySelector(".icon").innerHTML='<i class="fas fa-check" aria-hidden="true"></i>',s.disabled=!1,s.classList.remove("is-hidden")):(e.classList.remove("is-link"),e.querySelector(".icon").innerHTML='<i class="fas fa-minus" aria-hidden="true"></i>',s.classList.add("is-hidden"),s.disabled=!0)}}function y(n){n.preventDefault(),cityssm.postJSON(e.urlPrefix+"/attendance/doRecordCallIn",n.currentTarget,e=>{const n=e;if(n.success)switch(u(),n.callInType){case"absence":a=n.absenceRecords,r();break;case"returnToWork":l=n.returnToWorkRecords,c()}})}cityssm.openHtmlModal("callIn-add",{onshow(e){var s,a;if(d=e,o){e.querySelector("#callInAdd--absenceDateString-absence").valueAsDate=new Date;const s=e.querySelector("#callInAdd--absenceTypeKey-absence");for(const e of n){const n=document.createElement("option");n.value=e.absenceTypeKey,n.textContent=e.absenceType,s.append(n)}}else null===(s=e.querySelector("#callInAdd--callInType_absence"))||void 0===s||s.remove();t||null===(a=e.querySelector("#callInAdd--callInType_returnToWork"))||void 0===a||a.remove()},onshown(e,n){var s,o,t,a;u=n,null===(s=e.querySelector("form"))||void 0===s||s.addEventListener("submit",y),null===(o=e.querySelector("#callInAdd--employeeNumber"))||void 0===o||o.addEventListener("keyup",p),null===(t=e.querySelector("#callInAdd--callInType_absence"))||void 0===t||t.addEventListener("change",v),null===(a=e.querySelector("#callInAdd--callInType_returnToWork"))||void 0===a||a.addEventListener("change",v)}})}if(o||t){const e=document.querySelectorAll(".is-new-call-in-button");for(const n of e)n.addEventListener("click",i)}r(),c()})();