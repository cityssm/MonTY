"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),(()=>{const e=exports.MonTY,n=exports.absenceTypes,t=exports.employees,o=exports.absencesCanUpdate,s=exports.returnsToWorkCanUpdate;let r=exports.absenceRecords,a=exports.returnToWorkRecords;function l(n){const t=n.currentTarget.closest(".panel-block").dataset.recordId;bulmaJS.confirm({title:"Delete Absence Record",message:"Are you sure you want to delete this absence record?",contextualColorName:"warning",okButton:{text:"Yes, Delete Record",callbackFunction:function(){cityssm.postJSON(e.urlPrefix+"/attendance/doDeleteAbsenceRecord",{recordId:t},e=>{var n;const t=e;t.success?(bulmaJS.alert({message:"Absence record deleted successfully.",contextualColorName:"success"}),r=t.absenceRecords,c()):bulmaJS.alert({title:"Error Deleting Record",message:null!==(n=t.errorMessage)&&void 0!==n?n:"",contextualColorName:"danger"})})}}})}function c(){var e,n,t,o,s;const a=document.querySelector("#container--absences");if(null===a)return;if(0===r.length)return void(a.innerHTML='<div class="message is-info">\n        <p class="message-body">There are no recent absence records to show.</p>\n        </div>');const c=document.createElement("div");c.className="panel";let i=0;for(const a of r){const r=new Date(a.absenceDateTime),d=document.createElement("div");d.className="panel-block is-block",d.dataset.recordId=a.recordId,Date.now()-r.getTime()<=864e5&&(d.classList.add("has-background-success-light"),i+=1),d.innerHTML=`<div class="columns is-mobile">\n        <div class="column is-narrow">\n          <i class="fas fa-sign-out-alt" aria-hidden="true"></i>\n        </div>\n        <div class="column is-3">\n          <strong data-tooltip="Absence Date">\n            ${r.toLocaleDateString()}\n          </strong>\n        </div>\n        <div class="column is-4">\n          <strong>${a.employeeName}</strong><br />\n          <span class="is-size-7">${null!==(e=a.employeeNumber)&&void 0!==e?e:""}</span>\n        </div>\n        <div class="column">\n          <strong data-tooltip="Absence Type">${null!==(n=a.absenceType)&&void 0!==n?n:a.absenceTypeKey}</strong><br />\n          <span class="is-size-7">${null!==(t=a.recordComment)&&void 0!==t?t:""}</span>\n        </div>\n        </div>`,a.canUpdate&&(null===(o=d.querySelector(".columns"))||void 0===o||o.insertAdjacentHTML("beforeend",'<div class="column is-narrow">\n            <button class="button is-small is-danger is-delete-button" type="button">\n              <i class="fas fa-trash" aria-hidden="true"></i>\n            </button>\n          </div>'),null===(s=d.querySelector(".is-delete-button"))||void 0===s||s.addEventListener("click",l)),c.append(d)}a.innerHTML="",a.append(c),document.querySelector('#menu--attendance a[href="#tab--absences"] .tag').textContent=i.toString()}function i(n){const t=n.currentTarget.closest(".panel-block").dataset.recordId;bulmaJS.confirm({title:"Delete Return to Work Record",message:"Are you sure you want to delete this return to work record?",contextualColorName:"warning",okButton:{text:"Yes, Delete Record",callbackFunction:function(){cityssm.postJSON(e.urlPrefix+"/attendance/doDeleteReturnToWorkRecord",{recordId:t},e=>{var n;const t=e;t.success?(bulmaJS.alert({message:"Return to work record deleted successfully.",contextualColorName:"success"}),a=t.returnToWorkRecords,d()):bulmaJS.alert({title:"Error Deleting Record",message:null!==(n=t.errorMessage)&&void 0!==n?n:"",contextualColorName:"danger"})})}}})}function d(){var e,n,t,o,s;const l=document.querySelector("#container--returnsToWork");if(null===l)return;if(0===r.length)return void(l.innerHTML='<div class="message is-info">\n        <p class="message-body">There are no recent return to work records to show.</p>\n        </div>');const c=document.createElement("div");c.className="panel";let d=0;for(const r of a){const a=new Date(r.returnDateTime),l=document.createElement("div");l.className="panel-block is-block",l.dataset.recordId=r.recordId,Date.now()-a.getTime()<=864e5&&(l.classList.add("has-background-success-light"),d+=1),l.innerHTML=`<div class="columns is-mobile">\n        <div class="column is-narrow">\n          <i class="fas fa-sign-in-alt" aria-hidden="true"></i>\n        </div>\n        <div class="column is-3">\n          <strong data-tooltip="Return Date">${a.toLocaleDateString()}</strong>\n        </div>\n        <div class="column">\n          <strong>${r.employeeName}</strong><br />\n          <span class="is-size-7">${null!==(e=r.employeeNumber)&&void 0!==e?e:""}</span>\n        </div>\n        <div class="column">\n          <strong data-tooltip="Return Shift">${null!==(n=r.returnShift)&&void 0!==n?n:"(No Shift)"}</strong><br />\n          <span class="is-size-7">${null!==(t=r.recordComment)&&void 0!==t?t:""}</span>\n        </div>\n        </div>`,r.canUpdate&&(null===(o=l.querySelector(".columns"))||void 0===o||o.insertAdjacentHTML("beforeend",'<div class="column is-narrow">\n              <button class="button is-small is-danger is-delete-button" type="button">\n                <i class="fas fa-trash" aria-hidden="true"></i>\n              </button>\n            </div>'),null===(s=l.querySelector(".is-delete-button"))||void 0===s||s.addEventListener("click",i)),c.append(l)}l.innerHTML="",l.append(c),document.querySelector('#menu--attendance a[href="#tab--returnsToWork"] .tag').textContent=d.toString()}function u(l){let i,u,m="";function p(){const e=i.querySelector("#callInAdd--employeeNumber"),n=e.value.toLowerCase();if(n===m)return;m=n;const o=i.querySelector("#callInAdd--employeeName");o.value="";const s=t.filter(e=>n.length>=e.employeeNumber.length/2&&e.employeeNumber.toLowerCase().endsWith(n));1===s.length&&(e.value=s[0].employeeNumber,m=s[0].employeeNumber.toLowerCase(),o.value=(s[0].employeeGivenName+" "+s[0].employeeSurname).trim())}function b(){const e=i.querySelectorAll('input[name="callInType"]');for(const n of e){const e=n.closest("label"),t=i.querySelector(`fieldset[data-call-in-type="${n.value}"]`);n.checked?(e.classList.add("is-link"),e.querySelector(".icon").innerHTML='<i class="fas fa-check" aria-hidden="true"></i>',t.disabled=!1,t.classList.remove("is-hidden")):(e.classList.remove("is-link"),e.querySelector(".icon").innerHTML='<i class="fas fa-minus" aria-hidden="true"></i>',t.classList.add("is-hidden"),t.disabled=!0)}}function v(n){n.preventDefault(),cityssm.postJSON(e.urlPrefix+"/attendance/doRecordCallIn",n.currentTarget,e=>{const n=e;if(n.success)switch(u(),n.callInType){case"absence":r=n.absenceRecords,c();break;case"returnToWork":a=n.returnToWorkRecords,d()}})}cityssm.openHtmlModal("callIn-add",{onshow(e){var t,r;if(i=e,o){e.querySelector("#callInAdd--absenceDateString-absence").valueAsDate=new Date;const t=e.querySelector("#callInAdd--absenceTypeKey-absence");for(const e of n){const n=document.createElement("option");n.value=e.absenceTypeKey,n.textContent=e.absenceType,t.append(n)}}else null===(t=e.querySelector("#callInAdd--callInType_absence"))||void 0===t||t.remove();s||null===(r=e.querySelector("#callInAdd--callInType_returnToWork"))||void 0===r||r.remove()},onshown(e,n){var t,o,s,r;u=n,bulmaJS.toggleHtmlClipped(),null===(t=e.querySelector("form"))||void 0===t||t.addEventListener("submit",v),null===(o=e.querySelector("#callInAdd--employeeNumber"))||void 0===o||o.addEventListener("keyup",p),null===(s=e.querySelector("#callInAdd--callInType_absence"))||void 0===s||s.addEventListener("change",b),null===(r=e.querySelector("#callInAdd--callInType_returnToWork"))||void 0===r||r.addEventListener("change",b)},onremoved(){bulmaJS.toggleHtmlClipped()}})}if(o||s){const e=document.querySelectorAll(".is-new-call-in-button");for(const n of e)n.addEventListener("click",u)}c(),d()})();