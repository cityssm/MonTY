"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),(()=>{var e,t,l,s,a;const n=exports.MonTY;let o=exports.callOutLists;delete exports.callOutLists;const i=exports.callOutResponseTypes;delete exports.callOutResponseTypes;const r=null!==(t="true"===(null===(e=document.querySelector("main"))||void 0===e?void 0:e.dataset.isAdmin))&&void 0!==t&&t,c=null!==(s=null===(l=document.querySelector("main"))||void 0===l?void 0:l.dataset.userName)&&void 0!==s?s:"",u=exports.callOutsCanUpdate,d=exports.callOutsCanManage,m=document.querySelector("#callOuts--searchFilter"),p=document.querySelector("#callOuts--searchResults");let v="",y=[];function b(e){const t=e.currentTarget,l="1"===t.dataset.isFavourite,s=t.closest(".panel-block").dataset.listId;cityssm.postJSON(n.urlPrefix+(l?"/attendance/doRemoveFavouriteCallOutList":"/attendance/doAddFavouriteCallOutList"),{listId:s},e=>{o=e.callOutLists,f()})}function f(){var e,t,l,s,a;const n=document.createElement("div");n.className="panel";const i=m.value.trim().toLowerCase().split(" ");for(const r of o){let o=!0;const c=(r.listName+" "+(null!==(e=r.listDescription)&&void 0!==e?e:"")).toLowerCase();for(const e of i)if(!c.includes(e)){o=!1;break}if(!o)continue;const u=document.createElement("div");u.className="panel-block is-block",u.dataset.listId=r.listId.toString(),u.innerHTML=`<div class="columns is-mobile">\n        <div class="column is-narrow">\n          <button class="button is-white" data-is-favourite="${r.isFavourite?"1":"0"}" data-tooltip="Toggle Favourite" type="button">\n            ${r.isFavourite?'<i class="fas fa-star" aria-label="Favourite"></i>':'<i class="far fa-star" aria-label="Not Favourite"></i>'}\n          </button>\n        </div>\n        <div class="column">\n          <a class="is-block" href="#">\n          <strong>${r.listName}</strong><br />\n            <span class="is-size-7">${(null!==(t=r.listDescription)&&void 0!==t?t:"").replace(/\n/g,"<br />")}</span>\n          </a>\n        </div>\n        <div class="column is-narrow">\n          <span class="tag" data-tooltip="Members">\n            <span class="icon is-small"><i class="fas fa-hard-hat" aria-hidden="true"></i></span>\n            <span>${null!==(l=r.callOutListMembersCount)&&void 0!==l?l:""}</span>\n          </span>\n        </div>\n        </div>`,null===(s=u.querySelector("button"))||void 0===s||s.addEventListener("click",b),null===(a=u.querySelector("a"))||void 0===a||a.addEventListener("click",g),n.append(u)}n.hasChildNodes()?(p.innerHTML="",p.append(n)):p.innerHTML='<div class="message is-info">\n        <p class="message-body">There are no call out lists that meet your search criteria.</p>\n        </div>'}function L(e){e.preventDefault(),function e(t){const l=o.find(e=>e.listId===v);let s=0;const a=y.find((e,l)=>e.employeeNumber===t&&(s=l,!0));let d,m;function p(e){e.preventDefault();const t=e.currentTarget;cityssm.postJSON(n.urlPrefix+"/attendance/doAddCallOutRecord",t,e=>{const l=e;l.success&&(bulmaJS.alert({message:"Call out recorded successfully.",contextualColorName:"success"}),t.reset(),m=l.callOutRecords,f())})}function b(e){e.preventDefault();const l=e.currentTarget.closest(".panel-block").dataset.recordId;bulmaJS.confirm({title:"Delete Call Out Record",message:"Are you sure you want to delete this call out record?",contextualColorName:"warning",okButton:{text:"Yes, Delete Record",callbackFunction:function(){cityssm.postJSON(n.urlPrefix+"/attendance/doDeleteCallOutRecord",{recordId:l,employeeNumber:t,listId:v},e=>{const t=e;t.success&&(bulmaJS.alert({message:"Call out record deleted successfully.",contextualColorName:"success"}),m=t.callOutRecords,f())})}}})}function f(){var e,t,l;d.querySelector("#tag--recentCalls").textContent=m.length.toString();const s=d.querySelector("#container--callOutRecords"),a=d.querySelector("#callOutListMember--callOutDateTimeMax");if(0===m.length)return s.innerHTML='<div class="message is-info">\n          <p class="message-body">There are no recent call outs to show.</p>\n          </div>',void(a.textContent="(No Recent Call Outs)");const n=document.createElement("div");n.className="panel";for(const[s,o]of m.entries()){const i=new Date(o.callOutDateTime);0===s&&(a.innerHTML=`${o.isSuccessful?'<i class="fas fa-fw fa-check has-text-success" aria-label="Yes"></i>':'<i class="fas fa-fw fa-times has-text-danger" aria-label="No"></i>'}\n            ${i.toLocaleDateString()} ${i.toLocaleTimeString()}`);const d=document.createElement("div");d.className="panel-block is-block",d.dataset.recordId=o.recordId,d.classList.add(o.isSuccessful?"has-background-success-light":"has-background-danger-light"),d.innerHTML=`<div class="columns">\n          <div class="column is-narrow">\n            ${o.isSuccessful?'<i class="fas fa-fw fa-check has-text-success" aria-label="Yes"></i>':'<i class="fas fa-fw fa-times has-text-danger" aria-label="No"></i>'}\n          </div>\n          <div class="column">\n            ${i.toLocaleDateString()} ${i.toLocaleTimeString()}<br />\n            <span class="is-size-7">\n              <strong>${null!==(e=o.responseType)&&void 0!==e?e:"(No Response)"}</strong><br />\n              ${null!==(t=o.recordComment)&&void 0!==t?t:""}\n            </span>\n          </div>\n          <div class="column is-narrow">\n            ${u&&(r||o.recordCreate_userName===c)?'<button class="button is-inverted is-danger is-delete-button" data-tooltip="Delete Record">\n                  <i class="fas fa-trash" aria-hidden="true"></i>\n                  </button>':""}\n          </div>\n          </div>`,null===(l=d.querySelector(".is-delete-button"))||void 0===l||l.addEventListener("click",b),n.append(d)}s.innerHTML="",s.append(n)}cityssm.openHtmlModal("callOuts-member",{onshow(e){var o,i,r,c,p,v,b,L,S,g,O;d=e;const N=a.employeeSurname+", "+a.employeeGivenName;e.querySelector(".modal-card-title").textContent=N,e.querySelector("#callOutListMember--listName").textContent=l.listName,e.querySelector("#callOutListMember--employeeName").textContent=N,e.querySelector("#callOutListMember--employeeNumber").textContent=a.employeeNumber,e.querySelector("#callOutListMember--sortKey").textContent=null!==(o=a.sortKey)&&void 0!==o?o:"",e.querySelector("#callOutListMember--listPosition").textContent=`${s+1} / ${y.length}`,u?(e.querySelector("#callOutListMember--workContact1").textContent=null!==(i=a.workContact1)&&void 0!==i?i:"",e.querySelector("#callOutListMember--workContact2").textContent=null!==(r=a.workContact2)&&void 0!==r?r:"",e.querySelector("#callOutListMember--homeContact1").textContent=null!==(c=a.homeContact1)&&void 0!==c?c:"",e.querySelector("#callOutListMember--homeContact2").textContent=null!==(p=a.homeContact2)&&void 0!==p?p:""):(null===(b=null===(v=e.querySelector('a[href$="tab--callNow"]'))||void 0===v?void 0:v.closest("li"))||void 0===b||b.remove(),null===(L=e.querySelector("#tab--callNow"))||void 0===L||L.remove(),null===(g=null===(S=e.querySelector('a[href$="tab--recentCalls"]'))||void 0===S?void 0:S.closest("li"))||void 0===g||g.classList.add("is-active"),null===(O=e.querySelector("#tab--recentCalls"))||void 0===O||O.classList.remove("is-hidden")),cityssm.postJSON(n.urlPrefix+"/attendance/doGetCallOutRecords",{listId:l.listId,employeeNumber:t},e=>{m=e.callOutRecords,f()})},onshown(t,n){if(bulmaJS.toggleHtmlClipped(),bulmaJS.init(t),u){t.querySelector("#callOutRecordAdd--listId").value=l.listId,t.querySelector("#callOutRecordAdd--employeeNumber").value=a.employeeNumber;const e=t.querySelector("#callOutRecordAdd--responseTypeId");for(const t of i){const l=document.createElement("option");l.value=t.responseTypeId.toString(),l.textContent=t.responseType,e.append(l)}t.querySelector("#form--callOutRecordAdd").addEventListener("submit",p)}const o=t.querySelector("#callOutListMember--next");s+1===y.length?o.disabled=!0:o.addEventListener("click",()=>{const t=y[s+1].employeeNumber;n(),e(t)});const r=t.querySelector("#callOutListMember--previous");0===s?r.disabled=!0:r.addEventListener("click",()=>{const t=y[s-1].employeeNumber;n(),e(t)})},onhidden(){bulmaJS.toggleHtmlClipped()}})}(e.currentTarget.dataset.employeeNumber)}function S(e){let t;v=e,y=[];const l=o.find(t=>t.listId===e);let s;function a(e){if(e.preventDefault(),!d)return void bulmaJS.alert({title:"Access Denied",message:"You do not have permission to update call out lists.",contextualColorName:"danger"});const t=e.currentTarget.querySelector('button[type="submit"]');t.disabled=!0,t.classList.add("is-loading"),cityssm.postJSON(n.urlPrefix+"/attendance/doUpdateCallOutList",e.currentTarget,e=>{const l=e;t.disabled=!1,t.classList.remove("is-loading"),l.success?(bulmaJS.alert({message:"Call out list updated successfully.",contextualColorName:"success"}),s.querySelector(".modal-card-title").textContent=s.querySelector("#callOutListEdit--listName").value,y=l.callOutListMembers,r=l.availableEmployees,p(),m(),o=l.callOutLists,f()):bulmaJS.alert({title:"Error Updating Call Out List",message:"Please try again.",contextualColorName:"danger"})})}let i=[],r=[];function c(e){e.preventDefault();const t=e.currentTarget.dataset.employeeNumber;cityssm.postJSON(n.urlPrefix+"/attendance/doAddCallOutListMember",{listId:l.listId,employeeNumber:t},e=>{const t=e;t.success?(y=t.callOutListMembers,p(),m(),l.callOutListMembersCount=y.length,f()):bulmaJS.alert({title:"Error Adding Member",message:"Please try again.",contextualColorName:"danger"})})}function u(e){e.preventDefault();const t=e.currentTarget.dataset.employeeNumber;bulmaJS.confirm({title:"Remove Employee from Call Out List",message:`Are you sure you want to remove employee ${t} from the list?`,contextualColorName:"warning",okButton:{text:"Yes, Remove Them",callbackFunction:function(){cityssm.postJSON(n.urlPrefix+"/attendance/doDeleteCallOutListMember",{listId:l.listId,employeeNumber:t},e=>{const t=e;t.success?(y=t.callOutListMembers,p(),m(),l.callOutListMembersCount=y.length,f()):bulmaJS.alert({title:"Error Removing Member",message:"Please try again.",contextualColorName:"danger"})})}}})}function m(){var e;if(!d)return;const t=s.querySelector("#container--callOutListAvailableEmployees"),l=document.createElement("div");l.className="panel";for(const t of r){if(i.includes(t.employeeNumber))continue;const a=s.querySelector("#filter--callOutListAvailableEmployees").value.trim().toLowerCase().split(" "),n=(t.employeeGivenName+" "+t.employeeSurname).toLowerCase();let o=!0;for(const e of a)if(!n.includes(e)){o=!1;break}if(!o)continue;const r=document.createElement("a");r.className="panel-block",r.href="#",r.dataset.employeeNumber=t.employeeNumber,r.innerHTML=`<span class="panel-icon">\n          <i class="fas fa-plus" aria-hidden="true"></i>\n          </span>\n          <div>\n            <strong>${t.employeeSurname}, ${t.employeeGivenName}</strong><br />\n            <span class="is-size-7">${null!==(e=t.jobTitle)&&void 0!==e?e:""}</span>\n          </div>`,r.addEventListener("click",c),l.append(r)}l.hasChildNodes()?(t.innerHTML="",t.append(l)):t.innerHTML='<div class="message is-info is-small">\n            <p class="message-body">There are no employees available to add.</p>\n          </div>'}function p(){var e;const t=s.querySelector("#container--callOutListMembers"),a=s.querySelector("#container--callOutListCurrentMembers");if(i=[],0===y.length)return t.innerHTML=`<div class="message is-warning">\n            <p class="message-body">The "${l.listName}" call out list does not include any active employees.</p>\n          </div>`,void(a.innerHTML='<div class="message is-warning is-small">\n            <p class="message-body">No active employees.</p>\n          </div>');const n=document.createElement("div");let o;n.className="panel",d&&((o=document.createElement("div")).className="panel");for(const t of y){const l=document.createElement("a");if(l.className="panel-block is-block",l.href="#",l.dataset.employeeNumber=t.employeeNumber,l.innerHTML=`<div class="columns is-mobile">\n          <div class="column is-narrow">\n            <i class="fas fa-hard-hat" aria-hidden="true"></i>\n          </div>\n          <div class="column">\n            <strong>${t.employeeSurname}, ${t.employeeGivenName}</strong><br />\n            <span class="is-size-7">${t.employeeNumber}</span>\n          </div>\n          <div class="column">\n            <span class="is-size-7 has-tooltip-left" data-tooltip="Sort Key">\n              <i class="fas fa-sort-alpha-down" aria-hidden="true"></i> ${null!==(e=t.sortKey)&&void 0!==e?e:""}\n            </span><br />\n            <span class="is-size-7 has-tooltip-left" data-tooltip="Last Call Out Time">\n              <i class="fas fa-phone-volume" aria-hidden="true"></i> ${null===t.callOutDateTimeMax?"(No Recent Call Out)":new Date(t.callOutDateTimeMax).toLocaleDateString()}\n            </span>\n          </div>\n          </div>`,l.addEventListener("click",L),n.append(l),!d)continue;i.push(t.employeeNumber);const s=document.createElement("a");s.className="panel-block",s.href="#",s.dataset.employeeNumber=t.employeeNumber,s.innerHTML=`<span class="panel-icon">\n          <i class="fas fa-minus" aria-hidden="true"></i>\n          </span>\n          <div>\n            <strong>${t.employeeSurname}, ${t.employeeGivenName}</strong>\n          </div>`,s.addEventListener("click",u),o.append(s)}t.innerHTML="",t.append(n),d&&(a.innerHTML="",a.append(o))}function b(l){l.preventDefault(),bulmaJS.confirm({title:"Delete Call Out List",message:"Are you sure you want to delete this call out list?",contextualColorName:"warning",okButton:{text:"Yes, Delete Call Out List",callbackFunction:function(){cityssm.postJSON(n.urlPrefix+"/attendance/doDeleteCallOutList",{listId:e},e=>{const l=e;l.success&&(cityssm.disableNavBlocker(),t(),bulmaJS.alert({message:"Call Out List deleted successfully."}),o=l.callOutLists,f())})}}})}cityssm.openHtmlModal("callOuts-list",{onshow(e){var t,o,i;if(s=e,e.querySelector(".modal-card-title").textContent=l.listName,d){null===(t=e.querySelector(".tabs a[href$='tab--callOutMembers-manage']"))||void 0===t||t.classList.remove("is-hidden");const l=e.querySelector(".is-delete-call-out-list");null===(o=l.closest(".dropdown"))||void 0===o||o.classList.remove("is-hidden"),l.addEventListener("click",b)}else null===(i=e.querySelector("#tab--callOuts-members > .tabs"))||void 0===i||i.remove();!function(){var e,t,n,o,i;s.querySelector("#callOutListEdit--listId").value=l.listId,s.querySelector("#callOutListEdit--listName").value=l.listName,s.querySelector("#callOutListEdit--listDescription").value=null!==(e=l.listDescription)&&void 0!==e?e:"";let r=!1;const c=s.querySelector("#callOutListEdit--eligibilityFunction");for(const e of exports.employeeEligibilityFunctionNames){const t=document.createElement("option");t.value=e,t.textContent=e,e===l.eligibilityFunction&&(t.selected=!0,r=!0),c.append(t)}if(!r&&""!==(null!==(t=l.eligibilityFunction)&&void 0!==t?t:"")){const e=document.createElement("option");e.value=l.eligibilityFunction,e.textContent=l.eligibilityFunction,e.selected=!0,c.append(e)}let u=!1;const m=s.querySelector("#callOutListEdit--sortKeyFunction");for(const e of exports.employeeSortKeyFunctionNames){const t=document.createElement("option");t.value=e,t.textContent=e,e===l.sortKeyFunction&&(t.selected=!0,u=!0),m.append(t)}if(!u&&""!==(null!==(n=l.sortKeyFunction)&&void 0!==n?n:"")){const e=document.createElement("option");e.value=l.sortKeyFunction,e.textContent=l.sortKeyFunction,e.selected=!0,m.append(e)}if(s.querySelector("#callOutListEdit--employeePropertyName").value=null!==(o=l.employeePropertyName)&&void 0!==o?o:"",d){const e=s.querySelector("#callOutListEdit--unlockButtons");e.classList.remove("is-hidden"),null===(i=e.querySelector("button"))||void 0===i||i.addEventListener("click",()=>{var t;e.remove(),null===(t=s.querySelector("#callOutListEdit--updateButtons"))||void 0===t||t.classList.remove("is-hidden");const l=s.querySelector("#form--callOutListEdit");l.addEventListener("submit",a),l.querySelector("fieldset").disabled=!1})}}(),cityssm.postJSON(n.urlPrefix+"/attendance/doGetCallOutListMembers",{listId:l.listId,includeAvailableEmployees:d},e=>{var t;const l=e;y=l.callOutListMembers,r=l.availableEmployees,p(),m(),null===(t=s.querySelector("#filter--callOutListAvailableEmployees"))||void 0===t||t.addEventListener("keyup",m)})},onshown(l,s){t=s,bulmaJS.toggleHtmlClipped(),bulmaJS.init(l),n.initializeMenuTabs(l.querySelectorAll(".menu a"),l.querySelectorAll(".tabs-container > article")),l.querySelector("#reportingLink--callOutListReport").href=n.urlPrefix+"/print/screen/callOutList/?listId="+e,l.querySelector("#reportingLink--callOutListMembersCSV").href=n.urlPrefix+"/reports/callOutListMembers-formatted-byListId/?listId="+e,l.querySelector("#reportingLink--callOutRecordsCSV").href=n.urlPrefix+"/reports/callOutRecords-recent-byListId/?listId="+e,cityssm.enableNavBlocker()},onhidden(){bulmaJS.toggleHtmlClipped(),cityssm.disableNavBlocker(),v="",y=[]}})}function g(e){e.preventDefault(),S(e.currentTarget.closest(".panel-block").dataset.listId)}null===(a=document.querySelector("#callOuts--create"))||void 0===a||a.addEventListener("click",()=>{let e;function t(t){t.preventDefault(),cityssm.postJSON(n.urlPrefix+"/attendance/doCreateCallOutList",t.currentTarget,t=>{const l=t;o=l.callOutLists,f(),S(l.listId),e()})}cityssm.openHtmlModal("callOuts-createList",{onshown(l,s){var a;e=s,bulmaJS.toggleHtmlClipped(),l.querySelector("#callOutListAdd--listName").focus(),null===(a=l.querySelector("#form--callOutListAdd"))||void 0===a||a.addEventListener("submit",t)},onremoved(){bulmaJS.toggleHtmlClipped()}})}),f(),m.addEventListener("keyup",f)})();