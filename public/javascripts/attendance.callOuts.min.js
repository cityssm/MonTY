"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),(()=>{var e;const t=exports.MonTY;let n=exports.callOutLists;delete exports.callOutLists;exports.callOutsCanUpdate;const l=exports.callOutsCanManage,s=document.querySelector("#callOuts--searchFilter"),a=document.querySelector("#callOuts--searchResults");function i(){var e,t;const l=document.createElement("div");l.className="panel";const i=s.value.trim().toLowerCase().split(" ");for(const s of n){let n=!0;const a=(s.listName+" "+(null!==(e=s.listDescription)&&void 0!==e?e:"")).toLowerCase();for(const e of i)if(!a.includes(e)){n=!1;break}if(!n)continue;const o=document.createElement("a");o.className="panel-block",o.dataset.listId=s.listId.toString(),o.href="#",o.innerHTML=`<span class="panel-icon">\n        <i class="fas fa-list-ol" aria-hidden="true"></i>\n        </span>\n        <div>\n          <strong>${s.listName}</strong><br />\n          <span class="is-size-7">${null!==(t=s.listDescription)&&void 0!==t?t:""}</span>\n        </div>`,o.addEventListener("click",r),l.append(o)}l.hasChildNodes()?(a.innerHTML="",a.append(l)):a.innerHTML='<div class="message is-info">\n        <p class="message-body">There are no call out lists that meet your search criteria.</p>\n        </div>'}function o(e){const s=n.find(t=>t.listId===e);let a;function o(e){e.preventDefault(),l?cityssm.postJSON(t.urlPrefix+"/attendance/doUpdateCallOutList",e.currentTarget,e=>{const t=e;t.success?(bulmaJS.alert({message:"Call out list updated successfully.",contextualColorName:"success"}),a.querySelector(".modal-card-title").textContent=a.querySelector("#callOutListEdit--listName").value,n=t.callOutLists,i()):bulmaJS.alert({title:"Error Updating Call Out List",message:"Please try again.",contextualColorName:"danger"})}):bulmaJS.alert({title:"Access Denied",message:"You do not have permission to update call out lists.",contextualColorName:"danger"})}let r=[],c=[],u=[];function d(e){e.preventDefault();const n=e.currentTarget.dataset.employeeNumber;cityssm.postJSON(t.urlPrefix+"/attendance/doAddCallOutListMember",{listId:s.listId,employeeNumber:n},e=>{const t=e;t.success?(r=t.callOutListMembers,y(),p()):bulmaJS.alert({title:"Error Adding Member",message:"Please try again.",contextualColorName:"danger"})})}function m(e){e.preventDefault();const n=e.currentTarget.dataset.employeeNumber;bulmaJS.confirm({title:"Remove Employee from Call Out List",message:`Are you sure you want to remove employee ${n} from the list?`,contextualColorName:"warning",okButton:{text:"Yes, Remove Them",callbackFunction:function(){cityssm.postJSON(t.urlPrefix+"/attendance/doDeleteCallOutListMember",{listId:s.listId,employeeNumber:n},e=>{const t=e;t.success?(r=t.callOutListMembers,y(),p()):bulmaJS.alert({title:"Error Removing Member",message:"Please try again.",contextualColorName:"danger"})})}}})}function p(){var e;if(!l)return;const t=a.querySelector("#container--callOutListAvailableEmployees"),n=document.createElement("div");n.className="panel";for(const t of u){if(c.includes(t.employeeNumber))continue;const l=document.createElement("a");l.className="panel-block",l.href="#",l.dataset.employeeNumber=t.employeeNumber,l.innerHTML=`<span class="panel-icon">\n          <i class="fas fa-plus" aria-hidden="true"></i>\n          </span>\n          <div>\n            <strong>${t.employeeSurname}, ${t.employeeGivenName}</strong><br />\n            <span class="is-size-7">${null!==(e=t.jobTitle)&&void 0!==e?e:""}</span>\n          </div>`,l.addEventListener("click",d),n.append(l)}n.hasChildNodes()?(t.innerHTML="",t.append(n)):t.innerHTML='<div class="message is-info is-small">\n            <p class="message-body">There are no employees available to add.</p>\n          </div>'}function y(){const e=a.querySelector("#container--callOutListMembers"),t=a.querySelector("#container--callOutListCurrentMembers");if(c=[],0===r.length)return e.innerHTML=`<div class="message is-warning">\n            <p class="message-body">The "${s.listName}" call out list does not include any active employees.</p>\n          </div>`,void(t.innerHTML='<div class="message is-warning is-small">\n            <p class="message-body">No active employees.</p>\n          </div>');const n=document.createElement("div");let i;n.className="panel",l&&((i=document.createElement("div")).className="panel");for(const e of r){const t=document.createElement("a");if(t.className="panel-block",t.href="#",t.dataset.employeeNumber=e.employeeNumber,t.innerHTML=`<span class="panel-icon">\n          <i class="fas fa-user" aria-hidden="true"></i>\n          </span>\n          <div>\n            <strong>${e.employeeSurname}, ${e.employeeGivenName}</strong>\n          </div>`,n.append(t),!l)continue;c.push(e.employeeNumber);const s=document.createElement("a");s.className="panel-block",s.href="#",s.dataset.employeeNumber=e.employeeNumber,s.innerHTML=`<span class="panel-icon">\n          <i class="fas fa-minus" aria-hidden="true"></i>\n          </span>\n          <div>\n            <strong>${e.employeeSurname}, ${e.employeeGivenName}</strong>\n          </div>`,s.addEventListener("click",m),i.append(s)}e.innerHTML="",e.append(n),l&&(t.innerHTML="",t.append(i))}cityssm.openHtmlModal("callOuts-list",{onshow(e){var n,i;a=e,e.querySelector(".modal-card-title").textContent=s.listName,l&&(null===(i=null===(n=e.querySelector(".menu a[href$='tab--callOuts-memberManagement']"))||void 0===n?void 0:n.closest("li"))||void 0===i||i.classList.remove("is-hidden")),function(){var e,t,n,i;a.querySelector("#callOutListEdit--listId").value=s.listId,a.querySelector("#callOutListEdit--listName").value=s.listName,a.querySelector("#callOutListEdit--listDescription").value=null!==(e=s.listDescription)&&void 0!==e?e:"";let r=!1;const c=a.querySelector("#callOutListEdit--eligibilityFunction");for(const e of exports.employeeEligibilityFunctionNames){const t=document.createElement("option");t.value=e,t.textContent=e,e===s.eligibilityFunction&&(t.selected=!0,r=!0),c.append(t)}if(!r&&""!==(null!==(t=s.eligibilityFunction)&&void 0!==t?t:"")){const e=document.createElement("option");e.value=s.eligibilityFunction,e.textContent=s.eligibilityFunction,e.selected=!0,c.append(e)}let u=!1;const d=a.querySelector("#callOutListEdit--sortKeyFunction");for(const e of exports.employeeSortKeyFunctionNames){const t=document.createElement("option");t.value=e,t.textContent=e,e===s.sortKeyFunction&&(t.selected=!0,u=!0),d.append(t)}if(!u&&""!==(null!==(n=s.sortKeyFunction)&&void 0!==n?n:"")){const e=document.createElement("option");e.value=s.sortKeyFunction,e.textContent=s.sortKeyFunction,e.selected=!0,d.append(e)}if(l){const e=a.querySelector("#callOutListEdit--unlockButtons");e.classList.remove("is-hidden"),null===(i=e.querySelector("button"))||void 0===i||i.addEventListener("click",()=>{var t;e.remove(),null===(t=a.querySelector("#callOutListEdit--updateButtons"))||void 0===t||t.classList.remove("is-hidden");const n=a.querySelector("#form--callOutListEdit");n.addEventListener("submit",o),n.querySelector("fieldset").disabled=!1})}}(),cityssm.postJSON(t.urlPrefix+"/attendance/doGetCallOutListMembers",{listId:s.listId,includeAvailableEmployees:l},e=>{const t=e;r=t.callOutListMembers,u=t.availableEmployees,y(),p()})},onshown(e,n){t.initializeMenuTabs(e.querySelectorAll(".menu a"),e.querySelectorAll(".tabs-container > article"))}})}function r(e){e.preventDefault(),o(e.currentTarget.dataset.listId)}null===(e=document.querySelector("#callOuts--create"))||void 0===e||e.addEventListener("click",()=>{let e;function l(l){l.preventDefault(),cityssm.postJSON(t.urlPrefix+"/attendance/doCreateCallOutList",l.currentTarget,t=>{n=t.callOutLists,i(),e()})}cityssm.openHtmlModal("callOuts-createList",{onshown(t,n){var s;e=n,null===(s=t.querySelector("#form--callOutListAdd"))||void 0===s||s.addEventListener("submit",l)}})}),i(),s.addEventListener("keyup",i)})();